<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title> Flashcards - VoiceGo</title>
        <link rel="stylesheet" href="/static/style.css">


    </head>
    <body>
        <main>
            <h1><center>
                Your Flashcard
            </center></h1>

            <!-- Flashcard filter -->
            <div id="flashcard-controls" style="display:none;">
                <label for="jlpt-filter">Filter by JLPT Level:</label>
                <select id="jlpt-filter">
                    <option value="all">All</option>
                    <option value="N5">N5</option>
                    <option value="N4">N4</option>
                    <option value="N3">N3</option>
                    <option value="N2">N2</option>
                    <option value="N1">N1</option>
                </select>
                <button id="flashcard-prev">Previous</button>
                <button id="flashcard-next">Next</button>
            </div>

            <!-- Flashcard display -->
             
            <div id="flashcard-container" style="display:none;">
                <div id="flashcard" style="border: 1px solid #000; 
                                            width: 300px; height: 150px; 
                                            display:flex;
                                            align-items:center; 
                                            justify-content:center; 
                                            font-size: 1.5rem; 
                                            margin: 10px auto; 
                                            cursor: pointer;">
                    Loading...
                    <!-- Flashcard content will go here -->
                </div>
            </div>

            <script>
                // Flashcard function

                let allFlashcards = [];
                let levelFlashcards = [];
                let currentIndex = 0;
                let showFront = true;

                function createFlashcards() {
                    const vocabDataJSON = localStorage.getItem("vocabulary_list");
                    if (!vocabDataJSON) {
                        document.getElementById("flashcard").textContent = "No vocabulary data found.";
                        return;
                    }

                    const vocabData = JSON.parse(vocabDataJSON); 
                    allFlashcards = []
                    for (const [level, words] of Object.entries(vocabData)) {
                        words.forEach(word => {
                            allFlashcards.push( {
                                level: level,
                                front: `${word.Word} (${word.Pronunciation})`,
                                back: `${word.Meaning}`
                            });

                        });
                    }

                    levelFlashcards = [...allFlashcards];
                    if (levelFlashcards.length > 0) {
                        document.getElementById("flashcard-controls").style.display = "block";
                        document.getElementById("flashcard-container").style.display = "block";
                        currentIndex = 0;
                        showFront = true;
                        showCard();
                    }
                }

                // Show card
                function showCard() {
                    const card = levelFlashcards[currentIndex];
                    document.getElementById("flashcard").textContent = showFront ? card.front : card.back;
                }

                // Flip card
                document.getElementById("flashcard").addEventListener("click", () => {
                    showFront = !showFront;
                    showCard();
                });

                // Next card
                document.getElementById("flashcard-next").addEventListener("click", () => {
                    currentIndex = (currentIndex + 1) % levelFlashcards.length;
                    showFront = true;
                    showCard();
                });

                // Previous card
                document.getElementById("flashcard-prev").addEventListener("click", () => {
                    currentIndex = (currentIndex - 1 + levelFlashcards.length) % levelFlashcards.length;
                    showFront = true;
                    showCard();
                });

                // Filter by JLPT level
                document.getElementById("jlpt-filter").addEventListener("change", (event) => {
                    const level = event.target.value;
                    levelFlashcards = (level === "all") 
                        ? [...allFlashcards]
                        : allFlashcards.filter(card => card.level === level);
                    currentIndex = 0;
                    showFront = true;
                    showCard();
                });
                document.addEventListener("DOMContentLoaded", () => {
                    createFlashcards();
                });
            </script>
        </main>
    </body>
</html>